<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TCP和UDP | shenshen's study blog</title><meta name="keywords" content="计网,TCP,UDP"><meta name="author" content="Shen Shen"><meta name="copyright" content="Shen Shen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="mycode {     background-color: #fef4f5;     color: #FF6342; }    常考面试题：UDP 与 TCP 的区别是什么？  UDP 首先 UDP 协议是 面向无连接的，也就是说不需要在正式传递数据之前先连接起双方。然后 UDP 协议只是数据报文的搬运工，不保证有序且不丢失的传递到对端，并且 UDP 协议也没有任何控制流量的算法，总的来说 U">
<meta property="og:type" content="article">
<meta property="og:title" content="TCP和UDP">
<meta property="og:url" content="http://example.com/2021/03/06/TCP%E5%92%8CUDP/index.html">
<meta property="og:site_name" content="shenshen&#39;s study blog">
<meta property="og:description" content="mycode {     background-color: #fef4f5;     color: #FF6342; }    常考面试题：UDP 与 TCP 的区别是什么？  UDP 首先 UDP 协议是 面向无连接的，也就是说不需要在正式传递数据之前先连接起双方。然后 UDP 协议只是数据报文的搬运工，不保证有序且不丢失的传递到对端，并且 UDP 协议也没有任何控制流量的算法，总的来说 U">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.pixabay.com/photo/2020/08/17/18/38/cat-5496162_1280.jpg">
<meta property="article:published_time" content="2021-03-06T03:18:43.000Z">
<meta property="article:modified_time" content="2021-03-07T16:10:58.843Z">
<meta property="article:author" content="Shen Shen">
<meta property="article:tag" content="计网">
<meta property="article:tag" content="TCP">
<meta property="article:tag" content="UDP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.pixabay.com/photo/2020/08/17/18/38/cat-5496162_1280.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/03/06/TCP%E5%92%8CUDP/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-08 00:10:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.pixabay.com/photo/2020/08/17/18/38/cat-5496162_1280.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">shenshen's study blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">TCP和UDP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-06T03:18:43.000Z" title="发表于 2021-03-06 11:18:43">2021-03-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-07T16:10:58.843Z" title="更新于 2021-03-08 00:10:58">2021-03-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%BD%91/">计网</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><style>
mycode {
    background-color: #fef4f5;
    color: #FF6342;
}
</style>

<blockquote>
<p>常考面试题：<mycode>UDP</mycode> 与 <mycode>TCP</mycode> 的区别是什么？</p>
</blockquote>
<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><blockquote>
<p>首先 <mycode>UDP</mycode> 协议是 <strong>面向无连接的</strong>，也就是说不需要在正式传递数据之前先连接起双方。然后 <mycode>UDP</mycode> 协议只是数据报文的搬运工，<strong>不保证有序且不丢失的传递到对端</strong>，并且 <mycode>UDP</mycode> 协议也<strong>没有任何控制流量的算法</strong>，总的来说 <mycode>UDP</mycode> 相较于 <mycode>TCP</mycode> 更加的轻便。<mycode>UDP</mycode> <strong>支持多播和广播</strong>。</p>
</blockquote>
<h4 id="1-面向无连接"><a href="#1-面向无连接" class="headerlink" title="1. 面向无连接"></a>1. 面向无连接</h4><p>首先 <mycode>UDP</mycode> 是不需要和 <mycode>TCP</mycode> 一样在发送数据前进行三次握手建立连接的，想发数据就可以开始发送了。并且也只是数据报文的搬运工，不会对数据报文进行任何拆分和拼接操作。</p>
<blockquote>
<p>具体来说就是：</p>
<ul>
<li>在发送端，应用层将数据传递给传输层的 <mycode>UDP</mycode> 协议，<mycode>UDP</mycode> 只会给数据增加一个 <mycode>UDP</mycode> 头标识就传递给网络层了。</li>
<li>在接收端，网络层将数据传递给传输层，<mycode>UDP</mycode> 只去除 <mycode>IP</mycode> 报文头就传递给应用层，不会进行任何拼接操作。</li>
</ul>
</blockquote>
<h4 id="2-不可靠性"><a href="#2-不可靠性" class="headerlink" title="2. 不可靠性"></a>2. 不可靠性</h4><ul>
<li>首先不可靠性体现在<strong>无连接</strong>上，通信都不需要建立连接，想发就发，这样的情况肯定不可靠。</li>
<li>收到什么数据就传递什么数据，并且也不会备份数据，发送数据也不会关心对方是否已经正确接收到数据了。</li>
<li>再者网络环境时好时坏，但是 <mycode>UDP</mycode> 因为<strong>没有拥塞控制</strong>，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。**<span style="color:coral;">这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。</span>**</li>
</ul>
<h4 id="3-高效"><a href="#3-高效" class="headerlink" title="3. 高效"></a>3. 高效</h4><ul>
<li>虽然 <mycode>UDP</mycode> 协议不是那么的可靠，但是正是因为它不是那么的可靠，所以也就没有 <mycode>TCP</mycode> 那么复杂了，需要保证数据不丢失且有序到达。</li>
<li>因此 <mycode>UDP</mycode> 的头部开销小，只有<strong>八字节</strong>，相比 <mycode>TCP</mycode> 的至少二十字节要少得多，在传输数据报文时是很高效的。(源端口、目的端口、数据报文的长度、数据报文的校验值 [该字段用于发现头部信息和数据中的错误])。<br><img src="/2021/03/06/TCP%E5%92%8CUDP/UDP%E6%8A%A5%E5%A4%B4.png" alt="UDP报头"></li>
</ul>
<h4 id="4-传输方式"><a href="#4-传输方式" class="headerlink" title="4. 传输方式"></a>4. 传输方式</h4><p><mycode>UDP</mycode> 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 <mycode>UDP</mycode> <strong>提供了单播，多播，广播的功能</strong>。</p>
<h4 id="5-适合使用的场景"><a href="#5-适合使用的场景" class="headerlink" title="5. 适合使用的场景"></a>5. 适合使用的场景</h4><blockquote>
<p>在很多 <strong>实时性要求高</strong> 的地方都可以看到 <mycode>UDP</mycode> 的身影。</p>
</blockquote>
<ul>
<li>直播</li>
<li>游戏（王者荣耀）</li>
</ul>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><blockquote>
<p><mycode>TCP</mycode>的特性：</p>
<ul>
<li><mycode>TCP</mycode> 提供一种 <strong>面向连接的、可靠的</strong> 字节流服务</li>
<li>在一个 <mycode>TCP</mycode> 连接中，仅有两方进行彼此通信。<strong>广播和多播不能用于 <mycode>TCP</mycode></strong></li>
<li><mycode>TCP</mycode> 使用校验和，确认和重传机制来保证可靠传输</li>
<li><mycode>TCP</mycode> 给数据分节进行排序，并使用累积确认保证数据的顺序不变和非重复</li>
<li><mycode>TCP</mycode> 使用滑动窗口机制来实现流量控制，通过动态改变窗口的大小进行拥塞控制</li>
</ul>
</blockquote>
<h4 id="1-TCP报头"><a href="#1-TCP报头" class="headerlink" title="1. TCP报头"></a>1. TCP报头</h4><p><img src="/2021/03/06/TCP%E5%92%8CUDP/TCP%E6%8A%A5%E6%96%87%E5%A4%B4.png" alt="TCP报文头"></p>
<blockquote>
<p>对于 <mycode>TCP<mycode> 头部来说，以下几个字段是很重要的</mycode></mycode></p>
</blockquote>
<ul>
<li><mycode>序列号</mycode>，这个序号保证了 <mycode>TCP</mycode> 传输的报文都是有序的，对端可以通过序号顺序拼接报文</li>
<li><mycode>确认号</mycode>，表示数据接收端 <strong>期望</strong> 接收的下一个字节的编号是多少，同时也表示上一个序号的数据已经收到</li>
<li><mycode>窗口</mycode>，窗口大小，表示还能接收多少字节的数据，用于流量控制</li>
<li><strong>标识符</strong><ul>
<li><mycode>URG=1</mycode>：该字段为 1 表示本数据报的数据部分包含紧急信息，是一个高优先级数据报文，此时紧急指针有效。紧急数据一定位于当前数据包数据部分的最前面，紧急指针标明了紧急数据的尾部。</li>
<li><mycode>ACK=1</mycode>：该字段为 1 表示确认号字段有效。此外，<mycode>TCP</mycode> 还规定在连接建立后传送的所有报文段都必须把 ACK 置为 1。</li>
<li><mycode>PSH=1</mycode>：该字段为 1 表示接收端应该立即将数据 push 给应用层，而不是等到缓冲区满后再提交。</li>
<li><mycode>RST=1</mycode>：该字段为 1 表示当前 <mycode>TCP</mycode> 连接出现严重问题，可能需要重新建立 <mycode>TCP</mycode> 连接，也可以用于拒绝非法的报文段和拒绝连接请求。</li>
<li><mycode>SYN=1</mycode>：当SYN=1，ACK=0时，表示当前报文段是一个连接请求报文。当 SYN=1，ACK=1时，表示当前报文段是一个同意建立连接的应答报文。</li>
<li><mycode>FIN=1</mycode>：该字段为 1 表示此报文段是一个释放连接的请求报文。</li>
</ul>
</li>
</ul>
<h4 id="2-三次握手-重要"><a href="#2-三次握手-重要" class="headerlink" title="2. 三次握手(重要)"></a>2. 三次握手(重要)</h4><blockquote>
<p>首先假设主动发起请求的一端称为客户端，被动连接的一端称为服务端。不管是客户端还是服务端，<mycode>TCP</mycode> 连接建立完后都能发送和接收数据，所以 <strong><mycode>TCP</mycode> 是一个全双工的协议。</strong><br>起初，两端都为 <mycode>CLOSED</mycode> 状态。在通信开始前，双方都会创建 <mycode>TCB</mycode>。 服务器创建完 <mycode>TCB</mycode> 后便进入 <mycode>LISTEN</mycode> 状态，此时开始等待客户端发送数据。</p>
</blockquote>
<ul>
<li><p><strong>第一次握手(SYN=1, seq=x)</strong><br>客户端发送一个 <mycode>TCP</mycode> 的 <mycode>SYN</mycode> 标志位为1的请求报文，指明客户端打算连接的服务器的端口，以及<mycode>初始序号 X</mycode>,保存在请求报文的序列号(Sequence Number)字段里。<br>发送完毕后，客户端进入 <mycode>SYN_SEND</mycode> 状态。</p>
</li>
<li><p><strong>第二次握手(SYN=1, ACK=1, seq=y, ACKnum=x+1)</strong><br>服务器发回<strong>确认包(ACK)应答</strong>。即 <mycode>SYN</mycode> 标志位和 <mycode>ACK</mycode> 标志位均为1。服务器端选择自己 ISN 序列号，放到 Seq 域里，同时将确认序号(Acknowledgement Number)设置为客户的序列号加1，即X+1。<br>发送完毕后，服务器端进入 <mycode>SYN_RECEIVED</mycode> 状态。</p>
</li>
<li><p><strong>第三次握手(ACK=1，ACKnum=y+1)</strong><br>客户端再次发送确认包(ACK)，<mycode>ACK</mycode> 标志位为1，并且把服务器发来 <mycode>ACK</mycode> 的序号字段+1，放在确定字段中发送给对方，并且在数据段写ISN的+1。<br>发送完毕后，客户端进入 <mycode>ESTABLISHED</mycode> 状态，当服务器端接收到这个包时，也进入 <mycode>ESTABLISHED</mycode> 状态，<mycode>TCP</mycode> 握手结束。</p>
</li>
</ul>
<p><img src="/2021/03/06/TCP%E5%92%8CUDP/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png" alt="三次握手"></p>
<blockquote>
<p><strong>常考面试题</strong>：为什么 <mycode>TCP</mycode> 建立连接需要三次握手，明明两次就可以建立起连接</p>
<ul>
<li>答：因为这是为了防止出现失效的连接请求报文段被服务端接收的情况，从而产生错误，造成资源的浪费。</li>
<li>例子：可以想象如下场景。客户端发送了一个连接请求 <mycode>A</mycode>，但是因为网络原因造成了超时，这时 <mycode>TCP</mycode> 会启动超时重传的机制再次发送一个连接请求 <mycode>B</mycode>。此时请求顺利到达服务端，服务端应答完就建立了连接，然后接收数据后释放了连接。<ul>
<li>假设这时候连接请求 <mycode>A</mycode> 在两端关闭后终于抵达了服务端，那么此时服务端会认为客户端又需要建立 <mycode>TCP</mycode> 连接，从而应答了该请求并进入 <mycode>ESTABLISHED</mycode> 状态。但是客户端其实是 <mycode>CLOSED</mycode> 的状态，那么就会导致服务端一直等待，造成资源的浪费。</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="3-四次挥手-重要"><a href="#3-四次挥手-重要" class="headerlink" title="3. 四次挥手(重要)"></a>3. 四次挥手(重要)</h4><blockquote>
<p><mycode>TCP</mycode> 的连接的拆除需要发送四个包，因此称为<strong>四次挥手</strong>(Four-way handshake)，也叫做改进的三次握手。客户端或服务器均可主动发起挥手动作。</p>
</blockquote>
<ul>
<li><p><strong>第一次挥手(FIN=1，seq=x)</strong><br>假设客户端想要关闭连接，客户端发送一个 <mycode>FIN</mycode> 标志位为1的包，表示自己已经没有数据可以发送了，但是仍然可以接受数据。<br>发送完毕后，客户端进入 <mycode>FIN_WAIT_1</mycode> 状态。</p>
</li>
<li><p><strong>第二次挥手(ACK=1，ACKnum=x+1)</strong><br>服务器端确认客户端的 <mycode>FIN</mycode> 包，发送一个确认包，表明自己接受到了客户端关闭连接的请求，但还没有准备好关闭连接。**<span style="color:coral;">此时表明 客户端 到 服务端 的连接已经释放，不再接收 客户端 发的数据了。但是因为 TCP 连接是双向的，所以 服务端 仍旧可以发送数据给 客户端。</span>**<br>发送完毕后，服务器端进入 <mycode>CLOSE_WAIT</mycode> 状态，客户端接收到这个确认包之后，进入 <mycode>FIN_WAIT_2</mycode> 状态，等待服务器端关闭连接。</p>
</li>
<li><p><strong>第三次挥手(FIN=1，seq=y)</strong><br>服务器端准备好关闭连接时，向客户端发送结束连接请求，<mycode>FIN</mycode> 置为1。<br>发送完毕后，服务器端进入 <mycode>LAST_ACK</mycode> 状态，等待来自客户端的最后一个 <mycode>ACK</mycode>。</p>
</li>
<li><p><strong>第四次挥手(ACK=1，ACKnum=y+1)</strong><br>客户端接收到来自服务器端的关闭请求，发送一个确认包，并进入 <mycode>TIME_WAIT</mycode>状态，等待可能出现的要求重传的 <mycode>ACK</mycode> 包。<br>服务器端接收到这个确认包之后，关闭连接，进入 <mycode>CLOSED</mycode> 状态。<br>客户端等待了某个固定时间（两个最大段生命周期，<mycode>2MSL</mycode>，2 Maximum Segment Lifetime）之后，没有收到服务器端的 <mycode>ACK</mycode> ，认为服务器端已经正常关闭连接，于是自己也关闭连接，进入 <mycode>CLOSED</mycode> 状态。</p>
</li>
</ul>
<blockquote>
<p>为什么 客户端 要进入 <mycode>TIME-WAIT</mycode> 状态，等待 <mycode>2MSL</mycode> 时间后才进入 <mycode>CLOSED</mycode> 状态？<br>为了保证 服务端 能收到 客户端 的确认应答。若 客户端 发完确认应答后直接进入 <mycode>CLOSED</mycode> 状态，<strong>如果确认应答因为网络问题一直没有到达，那么会造成 服务端 不能正常关闭。</strong></p>
</blockquote>
<p><img src="/2021/03/06/TCP%E5%92%8CUDP/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png" alt="四次挥手"></p>
<h4 id="4-SYN攻击"><a href="#4-SYN攻击" class="headerlink" title="4. SYN攻击"></a>4. SYN攻击</h4><ul>
<li><p>什么是 <mycode>SYN 攻击</mycode>（SYN Flood）？</p>
<p>在三次握手过程中，服务器发送 <mycode>SYN-ACK</mycode> 之后，收到客户端的 <mycode>ACK</mycode> 之前的 <mycode>TCP</mycode> 连接称为 <mycode>半连接(half-open connect)</mycode>。此时服务器处于 <mycode>SYN_RCVD</mycode> 状态。当收到 <mycode>ACK</mycode> 后，服务器才能转入 <mycode>ESTABLISHED</mycode> 状态。</p>
<p>SYN 攻击指的是，攻击客户端在短时间内伪造大量不存在的IP地址，向服务器不断地发送SYN包，服务器回复确认包，并等待客户的确认。由于源地址是不存在的，服务器需要不断的重发直至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，导致目标系统运行缓慢，严重者会引起网络堵塞甚至系统瘫痪。</p>
<p>SYN 攻击是一种典型的 <strong><mycode>DoS/DDoS</mycode></strong> 攻击。</p>
</li>
<li><p>如何检测 <mycode>SYN 攻击</mycode>？</p>
<p>检测 <mycode>SYN 攻击</mycode> 非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击。在 Linux/Unix 上可以使用系统自带的 netstats 命令来检测 SYN 攻击。</p>
</li>
<li><p>如何防御 <mycode>SYN 攻击</mycode>？</p>
<p><mycode>SYN 攻击</mycode> <strong>不能完全被阻止</strong>，除非将TCP协议重新设计。我们所做的是尽可能的减轻SYN攻击的危害，常见的防御 SYN 攻击的方法有如下几种：</p>
<ul>
<li>缩短超时（SYN Timeout）时间</li>
<li>无效连接监视释放</li>
<li>过滤网关防护</li>
<li>SYN cookies技术（延缓TCB分配方法）</li>
</ul>
</li>
</ul>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://hit-alibaba.github.io/interview/basic/network/TCP.html">https://hit-alibaba.github.io/interview/basic/network/TCP.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qzcsu/article/details/72861891">https://blog.csdn.net/qzcsu/article/details/72861891</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Shen Shen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/03/06/TCP%E5%92%8CUDP/">http://example.com/2021/03/06/TCP%E5%92%8CUDP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">shenshen's study blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%BD%91/">计网</a><a class="post-meta__tags" href="/tags/TCP/">TCP</a><a class="post-meta__tags" href="/tags/UDP/">UDP</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.pixabay.com/photo/2020/08/17/18/38/cat-5496162_1280.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/06/%E5%B8%B8%E8%A7%81%E7%9A%84WEB%E6%94%BB%E5%87%BB%E5%88%86%E7%B1%BB/"><img class="prev-cover" src="https://cdn.pixabay.com/photo/2020/08/17/18/38/cat-5496162_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">常见的WEB攻击分类</div></div></a></div><div class="next-post pull-right"><a href="/2021/03/06/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/"><img class="next-cover" src="https://cdn.pixabay.com/photo/2020/11/27/12/59/woman-5781862_1280.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HTTP状态码</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/03/06/HTTP状态码/" title="HTTP状态码"><img class="cover" src="https://cdn.pixabay.com/photo/2020/11/27/12/59/woman-5781862_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-06</div><div class="title">HTTP状态码</div></div></a></div><div><a href="/2021/03/06/常见的WEB攻击分类/" title="常见的WEB攻击分类"><img class="cover" src="https://cdn.pixabay.com/photo/2020/08/17/18/38/cat-5496162_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-06</div><div class="title">常见的WEB攻击分类</div></div></a></div><div><a href="/2021/03/06/缓存/" title="缓存"><img class="cover" src="https://cdn.pixabay.com/photo/2021/02/08/16/03/dinosaur-5995333_1280.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-06</div><div class="title">缓存</div></div></a></div><div><a href="/2021/03/06/HTTP协议/" title="HTTP协议"><img class="cover" src="https://cdn.pixabay.com/photo/2021/02/06/19/29/pancakes-5989136_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-06</div><div class="title">HTTP协议</div></div></a></div><div><a href="/2021/03/08/HTTPS和HTTP2-0/" title="HTTPS和HTTP2.0"><img class="cover" src="https://cdn.pixabay.com/photo/2020/11/27/12/59/woman-5781862_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-08</div><div class="title">HTTPS和HTTP2.0</div></div></a></div><div><a href="/2021/03/08/跨域通信/" title="跨域通信"><img class="cover" src="https://cdn.pixabay.com/photo/2021/02/08/16/03/dinosaur-5995333_1280.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-08</div><div class="title">跨域通信</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP"><span class="toc-number">1.</span> <span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%9D%A2%E5%90%91%E6%97%A0%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.1.</span> <span class="toc-text">1. 面向无连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%8D%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">2. 不可靠性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%AB%98%E6%95%88"><span class="toc-number">1.3.</span> <span class="toc-text">3. 高效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">4. 传输方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%80%82%E5%90%88%E4%BD%BF%E7%94%A8%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">1.5.</span> <span class="toc-text">5. 适合使用的场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-number">2.</span> <span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-TCP%E6%8A%A5%E5%A4%B4"><span class="toc-number">2.1.</span> <span class="toc-text">1. TCP报头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B-%E9%87%8D%E8%A6%81"><span class="toc-number">2.2.</span> <span class="toc-text">2. 三次握手(重要)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B-%E9%87%8D%E8%A6%81"><span class="toc-number">2.3.</span> <span class="toc-text">3. 四次挥手(重要)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-SYN%E6%94%BB%E5%87%BB"><span class="toc-number">2.4.</span> <span class="toc-text">4. SYN攻击</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Shen Shen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>